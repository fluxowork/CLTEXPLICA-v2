<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DiagnÃ³stico CLTExplica</title>
  <style>
    body { font-family: monospace; padding: 16px; background: #111; color: #0f0; font-size: 13px; }
    .ok { color: #0f0; }
    .erro { color: #f44; }
    .info { color: #ff0; }
    h2 { color: #fff; border-bottom: 1px solid #333; padding-bottom: 8px; }
    pre { background: #222; padding: 8px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
<h2>ğŸ” DiagnÃ³stico CLTExplica</h2>
<div id="log"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/supabase-client.js"></script>
<script>
const log = document.getElementById('log')
function out(msg, tipo = 'info') {
  log.innerHTML += `<div class="${tipo}">${msg}</div>`
}

async function diagnostico() {
  // 1. URL atual
  out(`ğŸ“ URL: ${location.pathname}`, 'info')
  out(`ğŸ“ Host: ${location.host}`, 'info')

  // 2. Verificar pÃ¡ginas no DOM (nÃ£o existe nesse arquivo, mas testa o supabase)
  out('<br><h2>Supabase</h2>', 'info')

  // 3. Testar conexÃ£o Supabase
  try {
    out('Testando conexÃ£o...', 'info')
    const { data, error } = await sb.from('posts')
      .select('id, title, slug, status')
      .limit(5)

    if (error) {
      out(`âŒ Erro Supabase: ${JSON.stringify(error)}`, 'erro')
    } else {
      out(`âœ… Supabase OK â€” ${data.length} post(s) encontrado(s)`, 'ok')
      data.forEach(p => {
        out(`   ğŸ“„ [${p.status}] ${p.title?.substring(0,40)} (${p.slug})`, 'ok')
      })
    }
  } catch(e) {
    out(`âŒ ExceÃ§Ã£o: ${e.message}`, 'erro')
  }

  // 4. Testar posts publicados
  out('<br><h2>Posts publicados</h2>', 'info')
  try {
    const { data, error } = await sb.from('posts')
      .select('id, title, status')
      .eq('status', 'published')
      .limit(10)

    if (error) {
      out(`âŒ Erro: ${JSON.stringify(error)}`, 'erro')
    } else if (!data || data.length === 0) {
      out('âš ï¸ Nenhum post com status "published" encontrado!', 'erro')
      out('Os posts estÃ£o como "draft" â€” precisam ser publicados no dashboard', 'info')
    } else {
      out(`âœ… ${data.length} post(s) publicado(s)`, 'ok')
      data.forEach(p => out(`   âœ… ${p.title?.substring(0,50)}`, 'ok'))
    }
  } catch(e) {
    out(`âŒ ExceÃ§Ã£o: ${e.message}`, 'erro')
  }

  // 5. Testar categories
  out('<br><h2>Categorias</h2>', 'info')
  try {
    const { data, error } = await sb.from('categories').select('*')
    if (error) {
      out(`âŒ Erro: ${JSON.stringify(error)}`, 'erro')
    } else {
      out(`${data.length === 0 ? 'âš ï¸' : 'âœ…'} ${data.length} categoria(s) no banco`, data.length > 0 ? 'ok' : 'erro')
    }
  } catch(e) {
    out(`âŒ ExceÃ§Ã£o: ${e.message}`, 'erro')
  }

  // 6. Testar leads (tabela para e-mails)
  out('<br><h2>Tabela leads</h2>', 'info')
  try {
    const { data, error } = await sb.from('leads').select('id').limit(1)
    if (error) out(`âŒ Tabela leads: ${error.message}`, 'erro')
    else out(`âœ… Tabela leads existe`, 'ok')
  } catch(e) {
    out(`âŒ ExceÃ§Ã£o: ${e.message}`, 'erro')
  }

  out('<br><div class="ok">âœ… DiagnÃ³stico concluÃ­do</div>', 'ok')
}

diagnostico()
</script>
</body>
</html>
